#{extends 'main.html' /}
#{set title:'Accueil' /}
#{set 'moreStyles'}
<link type="text/css" rel="stylesheet" href="@{'/public/stylesheets/jqcloud.css'}">
#{/set}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/jqcloud-0.2.4.js'}" type="text/javascript" charset="${_response_encoding}"></script>
<script src="@{'/public/javascripts/tagcloud.js'}" type="text/javascript" charset="${_response_encoding}"></script>
#{/set}

<div class="container">
    <div class="hero-unit">
        <div class="row">
            <div class="span7">
                <h1>Mix-it</h1> 
                <h2>Des idées pour tout de suite !</h2>
                <p>X Avril 2012</p>
                #{if session.get("username") == null} 
                <a class="btn primary large" href="@{Login.index()}">Se connecter</a>
                #{/if}
                #{else}  
                <a class="btn primary large" href="@{Dashboard.index()}">Mon Dashboard</a>
                #{/else}
            </div>
            <div class="span7"> 
                <!-- You must explicitly specify the dimensions of the container element -->
                <div id="wordcloud" style="width: 250px; height: 250px; position: relative;"></div>
            </div>
        </div>
    </div>
    <div class="row">
        #{list items:articles, as:'article'}
        <div class="span-one-third">
            #{article article /}
        </div>
        #{/list}
    </div>
    <div class="row">
        <h4>Activités récentes</h4>
        <p id="activities"></p>
        <a id="moreActivities" href="#activities" class="btn small" onclick="loadMoreActivities()">&{'activities.more'}</a>  
        <img id="activitiesSpinner" class="spinner" src="/public/images/spinner.gif" alt="chargement..." />
        
<script type="text/javascript">
    var page = 1;
    var size = 5;
    var activitiesAction = #{jsAction @Activities.general(':page',':size') /};
    var spinner = $('#activitiesSpinner');
    var btnMoreActivities = $('#moreActivities');
   
    function loadMoreActivities() {
        btnMoreActivities.addClass('disabled');
        spinner.css("visibility", "visible");
        $.get(activitiesAction({page: page, size: size}), function(data) {
            $('#activities').append(data);
            if (data) {
                page++;
            } else {
                btnMoreActivities.css('visibility','hidden');
            }
        });
        spinner.css("visibility", "hidden");
        btnMoreActivities.removeClass('disabled');
    }
    
    // Initial loading : first page
    loadMoreActivities();
</script>            
    </div>
</div><!-- /container --> 
